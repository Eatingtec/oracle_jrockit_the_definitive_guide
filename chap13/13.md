<a anme="13" />
# 13 JRockit Virtual Edition

近些年，**虚拟化（virtualization，即在模拟硬件上运行软件）**，可谓是风头正劲。通过虚拟化可以最大化硬件资源利用率，同时可以简化资源管理。不过，作为应用程序和实际硬件中间的抽象层，虚拟化会带来额外的性能损耗。

本章将会对JRockit Virtual Edtion及其相关技术进行介绍。在本章中，会以JRockit VE作为JRockit Vritual Edtion的简称使用。

JRockit VE使用户可以在一个没有操作系统的虚拟环境中运行Java应用程序，同时免去了虚拟化所带来的大量性能损耗。JRockit VE是一款独立的产品，包含了运行Java应用程序所需要的最小环境，即一个轻量级的类OS内核和一个JRockit JRE。

JRockit VE可以运行任何Java应用程序，不过最初可能更多的是作为 **WLS on JRockit VE（WebLogic Server on JRockit Virtual Edtion）**产品的一部分来使用。WLS on JRockit VE是以虚拟机镜像（virtual machine image）格式预先打包好的WebLogic Server安装文件。虚拟机镜像是一个二进制镜像，其中包含了虚拟机配置，二进制软件和文件系统，将虚拟机镜像部署在专门的虚拟环境（例如Oracle VM Server）中，就可以运行相应的应用程序。

作为对JRockit VE相关技术的介绍，本章会着重讲解虚拟化JRockit VE背后的相关技术。对于构建与JRockit VE之上的软件栈，则不再赘述。

>本章旨在介绍新近技术产品，因此在细节、名称和具体实现上可能会因与目前所见到的有所区别，而且在本章中还有一些前瞻性的、还未实现的技术介绍。万变不离其宗，不论如何，核心概念上是相同的。相关产品的最新信息可以在官网的在线文档上查看。

本章主要包含以下内容：

* 虚拟化的基本概念以及几种不同的虚拟化实现的相关介绍
* Hypervisor相关介绍
* 软件栈虚拟化的优劣
* Java虚拟化的相关问题，以及JRockit VE简化虚拟化进程并提升性能的方法
* 虚拟机镜像相关概念
* 虚拟化的未来

<a name="13.1" />
# 13.1 虚拟化简介

近些年，虚拟化逐渐成为了热点话题，但它其实仍旧是将硬件资源抽象为一个虚拟层，这本身并不是什么新鲜事物。现在所有的操作系统中标配的虚拟内存就是一种虚拟化，单一物理硬盘划分为多个分区也是一种虚拟化。相比之下，最近热炒的虚拟化更多的是指虚拟整个物理机，不过这也不是什么新玩意，早在1960年代IBM就已经开始做相关的产品了。但直到最近，才真正充分发挥了虚拟化的威力，既增加了资源利用率，又提升了整体的管理能力。

虚拟化是以软件模拟运行平台（如操作系统）或在虚拟硬件上运行独立的应用程序。想你硬件通常与实际运行的物理硬件类似，部署在虚拟系统上的应用程序套件通常称为 **guest**，而被称为 **hypervisor**的软件栈则可以使多个 **guest**运行在同一个系统上。**hypervisor**可以为 **guest**提供设备驱动程序，使其可以运行在虚拟环境中，进而提升 **guest**程序的运行性能。

>不同类型的虚拟化资源在其具体是线上有所不同。例如，看起来像是物理硬盘的资源，实际上只是某处服务器上的一个或一组文件；看起来像是有4个物理CPU可用，实际上可能只是几个CPU分时共享而已；看起来有1GB物理内存可用，实际上可能只是大容量物理内存的一部分。某些 **hypervisor**程序甚至允许 **guest**程序分配出的内存容量超过其分配限额。不过对于 **guest**程序来说这无所谓，它仍旧只能看到其分配限额的内存（当然也有例外）。

虚拟化愈炒愈热，主要原因在于虚拟化可以更高效的利用已有的硬件资源。如果物理机上的CPU处于空闲状态（例如可能是在等待IO），那么就真的是只能闲置了。而对于那些运行了多个 **guest**程序的虚拟环境来说，若某个 **guest**程序的CPU处于空闲状态，则可以将CPU资源交给其他 **guest**程序使用。当然，若是多个 **guest**程序都特别"忙"，则反而会因频繁的上下文切换而降低执行性能。不过虚拟化的优势实在诱人，它大大提升了硬件资源的利用率，在环境问题日益严重的今天，合理利用资源才能更好的利用能源。

虚拟化可以划分为多种类型，划分的主要依据是其背后所代表的平台层级。这其中所涉及到一些常被混淆的技术概念，接下来内容中会对其做简单介绍。虚拟化本身很复杂，却使事情得以简化。